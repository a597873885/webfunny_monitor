var webfunnyGlobal=uni;!function(n){var r={};function o(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4)}([function(t,e){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var o=n(6);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(){return e.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,n.apply(this,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){e.exports=n(8)},function(e,t){Date.prototype.Format||(Date.prototype.Format=function(e){var t,n=e,r={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(t in/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,1===RegExp.$1.length?r[t]:("00"+r[t]).substr((""+r[t]).length)));return n})},function(e,t,n){var r=n(0).default,o=n(7);e.exports=function(e){return e=o(e,"string"),"symbol"==r(e)?e:String(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(0).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);if(n=n.call(e,t||"default"),"object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(G,e,t){"use strict";t.r(e);var e=t(0),o=t.n(e),f={mouseStayInfo:"",stayTime:0,uploadStayTimes:0,timerStatus:"on"},n=function(r){var o=(new Date).getTime(),a=0;setTimeout(function e(){a++;var t=new Date,n=1e3-((new Date).getTime()-(o+1e3*a));n<0&&(n=0);try{r(t)}catch(e){console.error("timer error：",e)}0<n?(f.timerStatus="on",setTimeout(e,n)):(f.timerStatus="off",console.log("定时器timer 结束"))},1e3)},e=t(3),u=t.n(e),c=(t(5),"$$$projectId$$$"),M=15e3,i=("object"===("undefined"==typeof navigator?"undefined":o()(navigator))&&"Microsoft Internet Explorer"==navigator.appName&&parseInt(navigator.appVersion.split(";")[1].replace(/[ ]/g,"").replace("MSIE","")),"WEBFUNNY_COOKIE"),s="webfunny_access_times",l="yyyy-MM-dd",e=webfunnyGlobal.webfunnyDomain||"$$$webfunny-event-domain$$$",r=webfunnyGlobal.webfunnyAssetsDomain||"Webfunny-Replace-AssetsDomain",a="",a=e,y={trackUrl:"".concat(a,"wfEvent/upEvents"),marqueeTrackUrl:"".concat(a,"wfEvent/buryPointVisualTracking/create"),screenShotUploadUrl:"".concat(a,"wfEvent/screenShot/upload"),eventDomain:a,requestMethod:"POST",visualJsUrl:"".concat(r,"wf_assets/event/wfVisual.js"),screenShotJsUrl:"".concat(r,"wf_assets/screenShot/html2canvas.min.js")},e=t(1),g=t.n(e),a=t(2),d=t.n(a);function B(){var e="";try{if(!(e=S("webfunnyWeSignature")||""))return"";var t=function(e){var t="";try{var n=e.split(""),r=n[2],o=(n[2]=n[21],n[21]=r,n[5]),a=(n[5]=n[18],n[18]=o,n[9]),i=(n[9]=n[15],n[15]=a,n[12]),s=(n[12]=n[31],n[31]=i,n[16]),c=(n[16]=n[28],n[28]=s,n[20]);n[20]=n[25],n[25]=c,t=n.reverse().join("")}catch(e){console.log("decryptSignature error",e)}return t}(e),n="".concat(t,":").concat(c);console.log("拼接秘钥",n),e=function(e){var t=0;try{for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n);t|=0}}catch(e){console.log("simpleHash error",e)}return t}(n).toString(16)}catch(e){console.log("generateSignature error",e)}return e}function W(){var e=y.eventDomain;return e}function A(e){new p(y.trackUrl).sendByXhr([e])}function R(e){b.addTask(y.trackUrl,e)}var p=function(){function t(e){g()(this,t),this.url=e}return d()(t,[{key:"sendByXhr",value:function(e){if(this.url)try{C.isH5()?this.url:webfunnyGlobal&&webfunnyGlobal.request({url:this.url,data:e,method:"POST",header:{"content-type":"application/json; charset=UTF-8","wf-signature":B()},success:function(e){e&&e.data&&t.handleAjaxRes("success",e.data)}})}catch(e){console.error("sendByXhr error",e)}}},{key:"sendByBeacon",value:function(e){this.url&&(webfunnyGlobal.navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon(this.url,JSON.stringify(e)):this.sendByXhr(e))}}],[{key:"handleAjaxRes",value:function(e,t){"success"===e&&t.data&&"object"===o()(t.data)&&(e=t.data.signature)&&C.setWfCookie("webfunnyWeSignature",e,(new Date).getTime()+864e5)}}]),t}(),v=null,b=new(function(){function e(){g()(this,e),this.uploadUrl="",this.queues=[]}return d()(e,[{key:"start",value:function(){var e,t=this;v||(e=0,v=setInterval(function(){(40<=e||20<t.queues.length)&&(t.fireTasks(),e=0),e++},200),this.finallyFireTasks())}},{key:"addTask",value:function(e,t){this.uploadUrl=e,this.queues.push(t)}},{key:"fireTasks",value:function(){var e=L().webfunnyHeatMap;"1"===(void 0===e?0:e)?f.stayTime=0:this.queues&&0<this.queues.length&&new p(this.uploadUrl).sendByXhr(this.queues),this.queues=[]}},{key:"finallyFireTasks",value:function(){}}]),e}());function J(e){return"[object Array]"===Object.prototype.toString.apply(e)}function $(e){return"[object Object]"===Object.prototype.toString.apply(e)}function q(){return!1}function L(){var e={};return e}function m(e){var t=encodeURIComponent(e);try{for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return webfunnyGlobal?webfunnyGlobal.arrayBufferToBase64(n):""}catch(e){return t}}function w(e,t){var n,r,o,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:(new Date).getTime()+2592e6;try{webfunnyGlobal&&(n={data:t,expires:a},(r=webfunnyGlobal.getStorageSync(i))?((r="string"==typeof r?JSON.parse(r):r)[e]=n,webfunnyGlobal.setStorageSync(i,r)):((o={})[e]=n,webfunnyGlobal.setStorageSync(i,o)))}catch(e){console.error("setWfCookie error",e)}}function h(e){try{if(webfunnyGlobal){var t,n,r=webfunnyGlobal.getStorageSync(i);if(console.log("获取模拟cookie: ",r),r)return(t=r[e])?(n=parseInt(t.expires,10))<(new Date).getTime()?(console.log("模拟cookie： "+e+"已过期，删除次数据"),delete r[e],webfunnyGlobal.setStorageSync(i,r),{data:"",expires:0}):{data:t.data,expires:n}:{data:"",expires:0}}return{data:"",expires:0}}catch(e){return console.error("getWfCookieBase error",e),{data:"",expires:0}}}function S(e){try{var t=h(e).data;return void 0===t?"":t}catch(e){return console.error("getWfCookie error",e),""}}function x(){var e=(new Date).Format("yyyyMMddhhmmssS");return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math[["m","o","d","n","a","r"].reverse().join("")]()|0;return("x"==e?t:3&t|8).toString(16)})+"-"+e}function T(){return e=D(),t="",n=x(),r=S("monitorCustomerKeys"),o=(new Date).getTime()+31104e7,r?(r=JSON.parse(r))[e]?t=r[e]:(r[e]=n,w("monitorCustomerKeys",JSON.stringify(r),o),t=n,0):((r={})[e]=n,w("monitorCustomerKeys",JSON.stringify(r),o),t=n,0),t;var e,t,n,r,o}function E(e){var t,n="";try{if(!e)return"";webfunnyGlobal&&(n=((t=webfunnyGlobal.getStorageSync("wmUserInfo"))?JSON.parse(t):{})[e])}catch(e){console.error("getWeUserInfo error",e)}return n||""}function O(){var e,t="";return t=getCurrentPages&&0<(e=getCurrentPages()).length?getCurrentPages()[e.length-1].route:t}function j(){var e={newStatus:1,firstPvDay:(new Date).getTime(),accessTimes:1};try{var t,n,r="",o=0,a=function(){var e=1;try{var t=S(s);t&&(e=+JSON.parse(t).count)}catch(e){console.error("getAccessTimes error",e)}return e}(),i=T();console.log("获取内置id: ",i),i?(t=i?i.match(/\d{14}/g):[])&&0<t.length&&(r=(o=(n=t[0].match(/\d{2}/g))[0]+n[1]+"-"+n[2]+"-"+n[3])===(new Date).Format(l)?1:2):r=1,e={newStatus:r,firstPvDay:o,accessTimes:a},console.log("用户信息: ",e)}catch(e){console.error("getAccessInfo error",e)}return e}function k(){var t={};try{var e=getCurrentPages();0<e.length&&(t=e[e.length-1])}catch(e){t={}}return t}function I(e,t){t=1<arguments.length&&void 0!==t?t:"weRelationPointId";try{var n=(S("weInitConfig")||{}).sessionTime,r=void 0===n?20:n,o=(new Date).getTime()+60*r*1e3,a=h(t)||{},i=a.data,s=a.expires,c=i;return c?(1e3<=c.length?-1===c.indexOf("~wf~【too long】")&&(c="".concat(c,"~wf~【too long】")):c="".concat(c,"~wf~").concat(e),console.log("pointId关系：",c),w(t,c,s)):w(t,e,o),m(i)}catch(e){return console.error("getWeRelationFieldValueByKey--",e),""}}function D(){var e=c,t="",t=e;return t=/^event\d*(_\d{8}_\d{9})$/.test(t)?t:e}function P(e){return(S("initPoints")?JSON.parse(S("initPoints")):{})[e]}function N(e,t,n,r,o){console.log("进入上报方法trackEvent：",e,t,n,r,o);try{e.webfunnyEventUtils.setFirstActionTime(o);var a,i=e.webfunnyEventUtils.getFirstActionTime(o),s=e.webfunnyEventGetCustomerInfo();for(a in t)"number"!=typeof t[a]&&(t[a]=e.webfunnyEventUtils.b64Code(t[a]));e.webfunnyEventUtils.combineObject(t,{projectId:r,pointId:o,weHappenTime:(new Date).getTime()}),e.webfunnyEventUtils.combineObject(t,s),e.webfunnyEventUtils.combineObject(t,{weFirstStepDay:i});var c=n&&n.originField?n.originField:"",u=n&&n.pointIdRelation||!1,l=e.webfunnyEventUtils.addWeRelationFiled(t,u,c);console.log("最终上报参数: ",l),e.webfunnyEventUtils.addTask(l),n&&!0===n.upNow&&e.webfunnyEventUtils.fireTasks()}catch(e){console.log("trackEvent error",e)}}var C={isString:function(e){return"[object String]"===Object.prototype.toString.apply(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.apply(e)},isArray:J,isObject:$,isDate:function(e){return"[object Date]"===Object.prototype.toString.apply(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.apply(e)},getUuid:x,getWfCookie:S,setWfCookie:w,b64Code:m,getPath:O,getXPath:function(e){try{for(var t=e.target,n=[];t.nodeType===Node.ELEMENT_NODE;){var r=t.nodeName.toLowerCase(),o=function(e,t){for(var n=0;e;)e.nodeName.toLowerCase()===t&&(n+=1),e=e.previousElementSibling;return n}(t,r);n.push("".concat(t.tagName.toLowerCase()).concat(1===o?"":"[".concat(o,"]"))),t=t.parentNode}return"/".concat(n.reverse().join("/"))}catch(e){return""}},getEleByXpath:function(e){try{var t=document;return t.evaluate(e,t).iterateNext()}catch(e){return console.error("getEleByXpath error",e),null}},combineObject:function(e,t){return u()(e,t)},getCustomerKey:T,getLastHeartBeatTime:function(e){var t=(new Date).getTime(),n=S("lastHearBeatTime");return n&&1!==e||(w("lastHearBeatTime",t,t+M+5e3),n=t),n},getWeUserInfo:E,setFirstActionTime:function(e){for(var t=S("weFunnelConfig").funnelList,n=void 0===t?[]:t,r=0;r<n.length;r++){var o=n[r],a=o.s,a=void 0===a?"":a,i=o.c,i=void 0===i?"":i,o=o.t,o=void 0===o?1:o,o=(new Date).getTime()+24*o*3600*1e3;-1!==a.indexOf(+e)&&(a=(new Date).Format("yyyyMMdd"),w("".concat(i,"-FirstStepDay"),"".concat(i,"-").concat(a),o))}},getFirstActionTime:function(e){for(var t=S("weFunnelConfig").funnelList,n=void 0===t?[]:t,r="",o=0;o<n.length;o++){var a=n[o],i=a.s,i=void 0===i?"":i,a=a.c,a=void 0===a?"":a;-1!==i.indexOf(+e)&&(r+=S("".concat(a,"-FirstStepDay"))+",")}return r},addTask:function(e){b.addTask(y.trackUrl,e)},fireTasks:function(){b.fireTasks()},getAccessInfo:j,recordAccessTimes:function(){var e=s,t=(new Date).getTime()+316224e5;console.log("设置访问次数开始",e);try{var n,r,o,a,i=S(e);console.log("accessTimesRes：",i),i?(n=(new Date).Format(l),a=void 0===(o=(r=JSON.parse(i)).count)?1:o,n!==r.lastDate&&w(e,JSON.stringify({count:+a+1,lastDate:(new Date).Format(l)}),t)):w(e,JSON.stringify({count:1,lastDate:(new Date).Format(l)}),t)}catch(e){console.error("setAccessTimes error",e)}},getCurrPage:k,addWeRelationFiled:function(t,e,n){console.log("addWeRelationFiled: ",t,e,n);try{var r,o,a,i=t.projectId,s=t.pointId,c={};return!0===e&&(r=t.pointId,o=I(r,"weRelationPointId"),c.weRelationPointId=o),n&&(a=I(t[n],"weRelationField-".concat(i,"-").concat(s)),c.weRelationField=a),u()(t,c)}catch(e){return console.error("addWeRelationFiled--",e),t}},getProjectId:D,getCommonPointId:P,isH5:q},U="",r={init:function(e){try{w("currentEventProjectId",c,(new Date).getTime()+864e5);var t=e.projectVersion,n=void 0===t?"1.0.0":t,r=e.env,o=void 0===r?"pro":r,a=e.setting,i=void 0===a?{}:a,s=(console.log("初始化版本信息",e),S("wfEventAppInfo"));s?"string"==typeof s&&(s=JSON.parse(s)):s={},s[c]={projectVersion:n},w("wfEventAppInfo",JSON.stringify(s),(new Date).getTime()+2592e6),w("wfEventEnv",o,(new Date).getTime()+2592e6),w("wfEventSetting",JSON.stringify(i),(new Date).getTime()+2592e6)}catch(e){console.log("init error",e)}},initUser:function(e){try{console.log("初始化用户信息",e,c);var t=S("wfEventUserInfo");t?"string"==typeof t&&(t=JSON.parse(t)):t={},t[c]=e,w("wfEventUserInfo",JSON.stringify(t),(new Date).getTime()+2592e6)}catch(e){console.log("initUser error",e)}},getWfCookie:S,setWfCookie:function(e,t,n){w(e,t,n)}};function F(){try{var e;f.stayTime<=2||((e=P("heatBeat"))?webfunnyGlobal.webfunnyEvent(e).trackEvent({stayTime:f.stayTime},{upNow:!0}):console.log("心跳点位没有初始化。"),f.stayTime=0,f.uploadStayTimes?f.uploadStayTimes+=1:f.uploadStayTimes=1)}catch(e){console.log("uploadStayTime error",e)}}function H(){n(function(e){var t={5:["0","5"],15:["00","15","30","45"],30:["00","30"],60:["00"]};try{var n,r,o,a,i,s,c,u=e.Format("mm:ss"),l=(f.stayTime?f.stayTime+=1:f.stayTime=1,JSON.parse(S("wfEventSetting")||"{}"));l.heartBeat?(o=void 0===(r=(n=l.heartBeat).enable)||r,i=void 0===(a=n.gap)?15:a,!1!==o&&(s=5==i?u.substring(4):u.substring(3),c=t[15],t[i]?c=t[i]:console.log("心跳间隔并非枚举值，请重新设置！"),-1!=c.indexOf(s))&&(F(),b.fireTasks())):-1!=t[15].indexOf(u.substring(3))&&(F(),b.fireTasks())}catch(e){console.log("startGlobalTimer error",e)}})}function K(){var e=T(),t=m(E("userId")),n=m(E("userType")),r=m(E("userTag")),o=m(E("des"));s=c=l="",webfunnyGlobal.getAppBaseInfo?(l=(webfunnyGlobal.getAppBaseInfo()||{}).model,c=(i=webfunnyGlobal.getDeviceInfo()||{}).system,s=i.platform):webfunnyGlobal&&(l=(i=webfunnyGlobal.getSystemInfoSync()||{}).model,c=i.system,s=i.platform),i="",a=c.split(" ");var a=void 0===(c=(l={deviceName:l,system:c,os:i=1<a.length?a[0]:i,platform:s}).deviceName)?"":c,i=l.system,s=void 0===i?"":i,c=void 0===(c=l.os)?"":c,u=void 0===(u=l.platform)?"":u,l=void 0===(l=l.browserName)?"":l,f=m(O()),y=(y=E("platform"))||u,u=j().newStatus;return{weCustomerKey:e,weUserId:t,weUserType:n,weUserLabel:r,weRemark:o,wePath:f,weDeviceName:a,wePlatform:y,weSystem:s,weOs:c,weBrowserName:l,weNewStatus:void 0===u?1:u}}var V,X,Y,_=webfunnyGlobal;try{_.WE_INIT_FLG=!1,V=function(e){_.WE_INIT_FLG=!0,C.setWfCookie("weInitConfig",e,(new Date).getTime()+864e5),C.setWfCookie("webfunnyWeSignature",e.signature,(new Date).getTime()+864e5),b.finallyFireTasks(),H()},X=E("userId"),Y=E("nickname"),webfunnyGlobal&&webfunnyGlobal.request({url:W()+"wfEvent/initCf",data:{projectId:c,userId:X,nickname:Y},dataType:"json",method:"POST",success:function(e){e=e.data.data||e.data;V(e)}});var z=_;console.log("启动PV点位记录");try{n(function(){var e,t,n,r,o,a=getCurrentPages();a.length&&(n=k(),e=k().route,U!=e)&&(n=n.options.title||"",r=t=e,a=2<=a.length?a[a.length-2].route:"",console.log("PV点位记录: ",{wePagePath:t,wePageTitle:n,weAccessAddress:r,weWebsitSource:a}),(o=P("browsing"))&&z.webfunnyEvent(o).trackEvent({wePagePath:t,wePageTitle:n,weAccessAddress:r,weWebsitSource:a},{upNow:!0}),U=e)})}catch(e){console.error("eventTracing error",e)}C&&(_.WebfunnyEvents=r,_.webfunnyEventUtils=C,_.webfunnyEventGetCustomerInfo=K,_.webfunnyEventUtils.getCustomerKey(),_.webfunnyEventUtils.getLastHeartBeatTime(1),_.webfunnyEventUtils.recordAccessTimes()),_.webfunnyEventSendRequest=A,_.webfunnyEventStoreLogs=R,_.webfunnyTrackEvent=N,_._webfunnyEvent=function(e){var t=C.getWfCookie("wfEventEnv"),n=(console.log("环境变量：",t),"object"===o()(e)?e[t]:e),r=C.getProjectId();return{fields:{},trackEvent:function(e,t){N(_,e,t,r,n)}}}}catch(e){console.log("init error",e)}}]);